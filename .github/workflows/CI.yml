# This workflow will build a Java project with Maven 
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven name: Java CI with Maven 
on: 
  push: 
    branches: [ Dockerfile ] 
  pull_request: 
    branches: [ Dockerfile ] 

jobs: 
  build: 
    runs-on: ubuntu-latest 
    steps: 
    - uses: actions/checkout@v2 
    - name: Set up JDK 11 
      uses: actions/setup-java@v2 
      with: 
        java-version: '11' 
        distribution: 'adopt' 
    - name: Build with Maven 
      run: mvn package
    - name: making war
      run: | 
        cd target 
        for f in *.jar; do mv -- "$f" "${f%.jar}.war"; done 
        cd .. 
    - name: Copy artifact to staging directory 
      run: | 
        mkdir staging
        cp target/*.war staging 
    - uses: actions/upload-artifact@v2 
      with: 
        name: Package 
        path: staging 

  containerization: 
    needs: build 
    runs-on: ubuntu-latest 
    steps: 
    - uses: actions/checkout@v2 
    - uses: actions/download-artifact@master 
      with: 
        name: Package 
        path: staging 
    - name: Auth to docker hub
      run:  docker login -u ${{secrets.DOCKER_HUB_USERNAME}} -p ${{secrets.DOCKER_HUB_PASSWORD}}
    - name: Build a docker container 
      run: docker build -t scythd/buffer:test .
    - name: Push a docker container   
      run: docker push scythd/buffer:test
    - name: Logout to docker hub
      run:  docker logout
      
    - name: delete unnessecary artifact
      uses: GeekyEggo/delete-artifact@v1.0.0
      with:
        name: Package
